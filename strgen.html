<!DOCTYPE html>
<html>

<head>

<title>String Generator</title>

<script src="node_modules/strgen-js/strgen.js"></script>
<script src="node_modules/jquery/dist/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="strgen.css">

<script>
    $(document).ready(function(){
        $("div.history_header").click(function(){
            if($("div.history_list").css("display") == "none"){
                //$("div.accordion_icon").text("-");
                $("div.history_list").slideToggle('fast');
            }
            else
            {
                //$("div.accordion_icon").text("+");
                $("div.history_list").slideUp('fast');
            }
        });

        // $("div.gen_button").click(function(){
        //  initialize_generator();
        // });
        //
        $("form[name='regex_form']").on('submit', initialize_generator);

        $("#enablelogging").change(function(){
            if ($(this).is(":checked"))
            {
                if (confirm('Enabling logging can cause performance problems. Are you sure?') == false) {
                    $(this).removeAttr("checked")
                }
            }
        });
    });
</script>

<script>
    var history = new Array();
    var count = 0;

    function initialize_generator() {
    try {
        document.getElementById('stringvalue').innerHTML = "";
        document.getElementById('error').innerHTML = "";
        var pattern = document.getElementById('templatebox').value;
        var allow_duplicate_characters = document.getElementById('allowduplicates').checked;
        var enable_logging = document.getElementById('enablelogging').checked;
        var reporting_type = document.getElementById('reportingdropdown').value;

        //if (pattern != "") {
            var generator = new Strgen();
            
            generator.pattern = pattern;
            generator.allow_duplicate_characters = allow_duplicate_characters;
            generator.allow_logging = enable_logging;
            generator.reporting_type = reporting_type;
            generator.error_output_id = "error";

            var generated_string = generator.createString();
            document.getElementById("stringvalue").innerHTML = generated_string;
            record_value(pattern, generated_string, generator.generator_log);
        //}

    } catch(error) {
        
        //document.getElementById('error').innerHTML += "<br />" + error.message;
        console.error(error.message);
        console.error(error.stack);
        
    }

    function record_value(pattern, generated_output, log_array) {
        if (log_array != "") {
            create_fields(pattern, generated_output, count, pattern, log_array);
            count += 1;
        }
    }

    function create_fields(pattern, generated_output, count, log_label, log_array) {
        var current_id = "result" + count;
        var current_count = count;

        if (!document.getElementById(current_id)){
            var container = document.createElement("div");

            container.setAttribute("id", current_id);
            container.setAttribute("class", "history_record");
            container.setAttribute("title", generated_output);

            document.getElementById("historylist").appendChild(container);
        }
        var divLabel = document.createElement("div"); // create log label

        divLabel.setAttribute("id", current_id + "_label");
        divLabel.setAttribute("class", "log_label");
        document.getElementById(current_id).appendChild(divLabel);

        document.getElementById(current_id + "_label").innerHTML = "<b>Log entry " + (current_count + 1) + ":</b> " + "   Pattern: " + log_label;

        var divExport = document.createElement("div"); // create export label

        divExport.setAttribute("id", current_id + "_export");
        divExport.setAttribute("class", "log_export");
        document.getElementById(current_id).appendChild(divExport);

        /*
        document.getElementById(current_id + "_export").innerHTML = "<a href=\"data:text/plain,\" + document.getElementById(\"current_id + \"_p\").innerHTML download=\"export.txt\"><b>Export</b></a>";
        */
        var paragraph = document.createElement("p"); // create log content

        paragraph.setAttribute("id", current_id + "_p");
        document.getElementById(current_id).appendChild(paragraph);

        var log_string = "";

        if (log_array != "") {
            for (var count = 0; count <= log_array.length - 1; count++) {
                log_string += log_array[count] + "~";
            }
        } else {
            log_string = "No log entries..."
        }

        var log_content = log_string.split('~').join("\r\n");
        var export_content = encodeURIComponent(log_content);

        document.getElementById(current_id + "_p").innerHTML = log_content;

        var a = document.getElementById(current_id + "_export").appendChild(
            document.createElement("a")
            );

        var currentdate = new Date(); 

        var date_string = currentdate.toLocaleDateString();
        date_string = date_string.split('/').join("-");

        var time_string = currentdate.toLocaleTimeString();
        time_string = time_string.split(':').join("-");
        
        var date_time_string = date_string + "-" + time_string;

        a.download = log_label + "_" + current_id + "_" + date_time_string + ".txt";
        a.href = "data:text/plain;charset=utf-8," + export_content;
        a.innerHTML = "Export";
    }
}
</script>

</head>

<body>
    <div class="backlayer"> </div>
    <img src="bg/regexgen-logo.jpeg" alt="Strgen">
    <h3 style="margin-top: 0px;">Recursive descent parser</h3>

    <section class="main_body">
        <section class="main_area">
        <form name="regex_form" action="javascript:void(0);">
            <!--form to contain the two textboxes and button-->
            <div class="inputwrap">
                <p>Template:</p>
                <input type="text" id="templatebox" value=""><br>
                <div id="error"></div>
            </div>

            <div class="inputwrap">
                <!--<p><input class="gen_button" type="button" onclick="initialize_generator()" value="Generate"></p>-->
                <br><button type="submit" id="custom_button" class="gen_button">Generate</div><br>

                <textarea id="stringvalue" rows="3" cols="75" readonly></textarea>
                
                <br><input type="checkbox" id="allowduplicates" checked /> 
                <label for="allowduplicates">Allow Duplicate Characters</label><br>

                <input type="checkbox" class="enable_logging" id="enablelogging" /> 
                <label for="enabledlogging">Enable Logging</label><br>

                <label for=reportingdropdown> Reporting type: </label>
                <select id=reportingdropdown>
                    <option value="full">Full</option>
                    <option value="less">Less</option>
                    <option value="none">None</option>
                </select> <br>
            </div>
        </form>

        </section>

        <section class = "history">
            <div class="history_header" id="historyheader"><h4>Log</h4>
                <div class="accordion_icon"></div>
            </div>
            <div class="history_list" id="historylist"></div>
        </section>

        <section class="doc">
            <h3>Documentation</h3>

            <div>
                <h4>Pre-defined ranges</h4> <br>

                <p>The following will pick a character from a predefined set of characters:</p>
                <ul >
                    <li>\w - word characters</li>
                    <li>\p - punctuation characters</li>
                    <li>\d - digits</li>
                    <li>\c - lower case characters</li>
                    <li>\u - upper case characters</li>
                    <li>\l - letters</li>
                    <li>\h - hex digits (lower case letters only)</li>
                    <li>\H - hex digits (lower and upper case)</li>
                    <li>\o - octal digits</li><br>
                </ul>

                <p> Click <a href="strgen_doc.html">here</a> for detailed documentation.</p>
            </div>

        </section>

    </section>

</body>

</html>
